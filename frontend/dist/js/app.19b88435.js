(function(e){function t(t){for(var s,o,l=t[0],d=t[1],r=t[2],c=0,m=[];c<l.length;c++)o=l[c],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&m.push(n[o][0]),n[o]=0;for(s in d)Object.prototype.hasOwnProperty.call(d,s)&&(e[s]=d[s]);u&&u(t);while(m.length)m.shift()();return i.push.apply(i,r||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],s=!0,l=1;l<a.length;l++){var d=a[l];0!==n[d]&&(s=!1)}s&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var s={},n={app:0},i=[];function o(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=s,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(a,s,function(t){return e[t]}.bind(null,s));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var r=0;r<l.length;r++)t(l[r]);var u=d;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},4678:function(e,t,a){var s={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=i,e.exports=n,n.id="4678"},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("md-app",[a("md-app-toolbar",{staticClass:"md-primary"},[a("md-button",{attrs:{to:"/queues"}},[a("md-icon",[e._v("list")]),e._v(" Alla köer ")],1),null!==e.$store.state.profile&&e.$store.state.profile.teacher?a("md-button",{attrs:{to:"/admin"}},[a("md-icon",[e._v("build")]),e._v(" Administration ")],1):e._e(),a("div",{staticClass:"md-toolbar-section-end"},[null===e.$store.state.profile?a("md-button",{on:{click:function(t){return e.$root.redirect_login()}}},[a("md-icon",[e._v("face")]),e._v(" Logga in ")],1):e._e(),null!==e.$store.state.profile?a("md-button",{on:{click:function(t){return e.set_location("/logout")}}},[a("md-icon",[e._v("exit_to_app")]),e._v(" Logga ut ")],1):e._e()],1)],1),a("md-app-content",[a("router-view")],1),a("md-snackbar",{attrs:{"md-position":"center","md-active":!e.$store.state.socket_connected,"md-persistent":""}},[a("span",[e._v("Enqueue är inte ansluten till nätverket. Försöker återansluta...")])])],1)},i=[],o=a("bc3a"),l=a.n(o),d={methods:{handleSocket(){this.$store.state.socket.on("connect",async()=>{this.$store.commit("setSocketConnected",!0);const e=(await l.a.get("/me")).data;this.$store.commit("setProfile",e.profile),this.$store.commit("setLocation",e.location),this.$store.commit("setAssistingIn",e.assisting_in),this.$store.commit("isKthlan",e.is_kthlan)}),this.$store.state.socket.on("disconnect",()=>{this.$store.commit("setSocketConnected",!1)}),this.$store.state.socket.on("profile",e=>{this.$store.commit("setProfile",e)}),this.$store.state.socket.connect()}},created(){this.handleSocket()}},r=d,u=a("2877"),c=Object(u["a"])(r,n,i,!1,null,null,null),m=c.exports,_=a("8c4f"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("Administration")]),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Lärare ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_teacher(t)}}},[a("md-field",[a("label",{attrs:{for:"user_name"}},[e._v("KTH-användarnamn")]),a("md-input",{attrs:{type:"text",id:"user_name"},model:{value:e.user_name,callback:function(t){e.user_name=t},expression:"user_name"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Lägg till lärare ")])],1)],1),a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Användarnamn")]),a("md-table-head",[e._v("Namn")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.teachers,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(t.user_name))]),a("md-table-cell",[e._v(e._s(t.name))]),a("md-table-cell",[t.id!==e.$store.state.profile.id?a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_teacher(t)}}},[e._v(" Radera ")]):e._e()],1)],1)}))],2)],1)],1),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Skapa ny kö ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_queue(t)}}},[a("md-field",[a("label",{attrs:{for:"queue_name"}},[e._v("Namn")]),a("md-input",{attrs:{type:"text",id:"queue_name",name:"queue_name"},model:{value:e.queue_name,callback:function(t){e.queue_name=t},expression:"queue_name"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Lägg till kö ")])],1)],1)])],1),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Terminalsalar ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_room(t)}}},[a("md-field",[a("label",{attrs:{for:"room_name"}},[e._v("Namn")]),a("md-input",{attrs:{type:"text",id:"room_name"},model:{value:e.room_name,callback:function(t){e.room_name=t},expression:"room_name"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Lägg till sal ")])],1)],1),a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Namn")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.rooms,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(t.name))]),a("md-table-cell",[a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_room(t)}}},[e._v(" Radera ")])],1)],1)}))],2)],1)],1)],1)},f=[],p={name:"Admin",data:()=>({user_name:null,queue_name:null,room_name:null,teachers:[],rooms:[]}),methods:{async add_teacher(){try{await l.a.post("/teachers",{user_name:this.user_name}),this.user_name=null}catch(e){switch(e.response?e.response.data.error:null){case"UNKNOWN_USER":alert("Användaren hittades inte.");break;case"ALREADY_TEACHER":alert("Användaren har redan lärarbehörighet.");break;default:alert(e||"Ett okänt fel inträffade.")}}},async remove_teacher(e){try{await l.a.delete("/teachers/"+e.id)}catch(t){t.response?404===t.response.status?alert("Läraren hittades inte."):401===t.response.status?alert("Åtkomst nekad"):alert("Ett okänt fel inträffade."):alert("Ett okänt fel inträffade.")}},async add_queue(){try{const e=(await l.a.post("/queues",{name:this.queue_name})).data;this.$router.push("/queues/"+e.name)}catch(e){e.response&&400===e.response.status?alert("Namnet är ogiltigt."):alert("Ett okänt fel inträffade.")}},add_room(){},remove_room(){}},async created(){this.teachers=(await l.a.get("/teachers")).data,this.rooms=(await l.a.get("/rooms")).data,this.$store.state.socket.on("teachers",e=>{this.teachers=e})}},b=p,g=Object(u["a"])(b,h,f,!1,null,null,null),v=g.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Alla köer ")])]),a("md-card-content",[a("md-table",e._l(e.queues,(function(t){return a("md-table-row",{key:t.id,staticStyle:{cursor:"pointer"},nativeOn:{click:function(a){return e.open_queue(t)}}},[a("md-table-cell",[t.open?a("md-icon",[e._v(" lock_open ")]):a("md-icon",{staticClass:"md-accent"},[e._v(" lock ")]),e._v(" "+e._s(t.name)+" ")],1),a("md-table-cell",{staticClass:"text-right"},[e._v(" "+e._s(t.queuing_count)+" ")])],1)})),1)],1)],1)],1)},q=[],y={name:"Queues",data:()=>({queues:[]}),methods:{open_queue(e){this.$router.push("/queues/"+e.name)}},async created(){this.queues=(await l.a.get("/queues")).data.sort((e,t)=>e.open&&!t.open?-1:!e.open&&t.open?1:e.name<t.name?-1:e.name>t.name?1:0)}},j=y,w=Object(u["a"])(j,k,q,!1,null,null,null),x=w.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.queue?a("div",[a("md-dialog-alert",{staticStyle:{"white-space":"pre-line"},attrs:{"md-title":"Meddelande","md-active":e.broadcast_active,"md-content":e.broadcast_message,"md-confirm-text":"OK!"},on:{"update:mdActive":function(t){e.broadcast_active=t},"update:md-active":function(t){e.broadcast_active=t},"md-closed":function(t){e.broadcast_active=!1}}}),a("md-dialog-alert",{staticStyle:{"white-space":"pre-line"},attrs:{"md-title":"Meddelande","md-active":e.notify_active,"md-content":e.notification_message,"md-confirm-text":"OK!"},on:{"update:mdActive":function(t){e.notify_active=t},"update:md-active":function(t){e.notify_active=t},"md-closed":function(t){e.broadcast_active=!1}}}),a("md-dialog-prompt",{attrs:{"md-active":e.prompt_broadcast,"md-title":"Meddela samtliga","md-input-placeholder":"Skriv meddelande...","md-confirm-text":"Skicka","md-cancel-text":"Avsluta"},on:{"update:mdActive":function(t){e.prompt_broadcast=t},"update:md-active":function(t){e.prompt_broadcast=t},"md-confirm":e.broadcast,"md-cancel":function(t){e.prompt_broadcast=!1}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),a("md-dialog-prompt",{attrs:{"md-active":e.promt_notify_faculty,"md-title":"Meddela assistenter","md-input-placeholder":"Skriv meddelande...","md-confirm-text":"Skicka","md-cancel-text":"Avsluta"},on:{"update:mdActive":function(t){e.promt_notify_faculty=t},"update:md-active":function(t){e.promt_notify_faculty=t},"md-confirm":e.broadcast_faculty,"md-cancel":function(t){e.promt_notify_faculty=!1}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),a("md-dialog-confirm",{attrs:{"md-active":e.promt_clear_queue&&0!==e.queue.queuing.length,"md-title":"Vill du rensa kön?","md-confirm-text":"Ja, rensa kön","md-cancel-text":"Nej, återgå"},on:{"md-confirm":function(t){return e.purge()},"md-cancel":function(t){e.promt_clear_queue=!1}}}),null!==e.dialog_queuing?a("md-dialog",{attrs:{"md-active":!0}},[a("md-dialog-content",[a("h2",[e._v(" "+e._s(e.queue.queuing.findIndex((function(t){return t.profile.id===e.dialog_queuing.profile.id}))+1)+". "),null!==e.dialog_queuing.profile.user_name?a("span",[e._v(e._s(e.dialog_queuing.profile.name)+" ("+e._s(e.dialog_queuing.profile.user_name)+")")]):e._e()]),a("strong",[e._v("Gick in i kön:")]),e._v(" "+e._s(e.unix_to_datetime(e.dialog_queuing.entered_at))),a("br"),a("strong",[e._v("Plats:")]),e._v(" "),a("span",{class:[{badLocation:e.dialog_queuing.bad_location}]},[e._v(e._s(e.nice_location(e.dialog_queuing.location)))]),a("br"),null!==e.dialog_queuing.comment?[a("strong",[e._v("Kommentar:")]),e._v(" "+e._s(e.dialog_queuing.comment)),a("br")]:e._e(),e.dialog_queuing.handlers.length>0?[a("strong",[e._v("Assisteras av:")]),e._v(" "+e._s(e.dialog_queuing.handlers.map((function(e){return e.name+" ("+e.user_name+")"})).join(", "))+" ")]:e._e()],2),a("md-dialog-actions",[e.is_assistant_in_queue?a("span",[a("md-button",{staticClass:"md-accent",on:{click:function(t){return e.dequeue(e.dialog_queuing)}}},[e._v("Ta bort")]),a("md-button",{class:[{"md-accent":!e.dialog_queuing.bad_location}],on:{click:function(t){return e.queuing_bad_location(e.dialog_queuing)}}},[e._v("Placering")]),void 0===e.dialog_queuing.handlers.find((function(t){return t.id===e.$store.state.profile.id}))?a("md-button",{staticClass:"md-primary",on:{click:function(t){return e.queuing_handle(e.dialog_queuing.profile)}}},[e._v("Assistera")]):a("md-button",{on:{click:function(t){return e.queuing_handle(e.dialog_queuing.profile)}}},[e._v("Sluta assistera")])],1):e._e(),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.dialog_queuing=null}}},[e._v(" Stäng ")])],1)],1):e._e(),null!==e.dialog_booking?a("md-dialog",{attrs:{"md-active":!0}},[a("md-dialog-content",[a("h2",[e._v("Tidslucka "+e._s(e.unix_to_datetime(e.dialog_booking.timestamp)))]),null!==e.$store.state.profile?[a("strong",[e._v("Namn:")]),e._v(" "+e._s(e.dialog_booking.students.map((function(e){return e.name+" ("+e.user_name+")"})).join(", "))),a("br")]:e._e(),a("strong",[e._v("Plats:")]),e._v(" "),null===e.dialog_booking.location?a("span",{staticClass:"noLocation"},[e._v("ingen plats angiven")]):a("span",{class:[{badLocation:e.dialog_booking.bad_location}]},[e._v(e._s(e.dialog_booking.location))]),a("br"),null!==e.dialog_booking.comment?[a("strong",[e._v("Kommentar:")]),e._v(" "+e._s(e.dialog_booking.comment)),a("br")]:e._e(),e.dialog_booking.handlers.length>0?[a("strong",[e._v("Assisteras av:")]),e._v(" "+e._s(e.dialog_booking.handlers.map((function(e){return e.name+" ("+e.user_name+")"})).join(", "))+" ")]:e._e()],2),a("md-dialog-content",[null!==e.$store.state.profile&&-1!==e.dialog_booking.students.findIndex((function(t){return t.id===e.$store.state.profile.id}))?a("form",{staticStyle:{display:"inline-flex"},on:{submit:function(t){return t.preventDefault(),e.booking_set_location(t)}}},[a("md-field",[a("label",{attrs:{for:"booking_location"}},[e._v("Ange plats")]),a("md-input",{attrs:{type:"text",id:"booking_location"},model:{value:e.booking_location,callback:function(t){e.booking_location=t},expression:"booking_location"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Spara ")])],1)],1):e._e()]),a("md-dialog-actions",[e.is_assistant_in_queue?a("span",[a("md-button",{staticClass:"md-accent",on:{click:function(t){return e.booking_remove(e.dialog_booking)}}},[e._v("Ta bort")]),null!==e.dialog_booking.location?a("md-button",{class:[{"md-accent":!e.dialog_booking.bad_location}],on:{click:e.booking_bad_location}},[e._v("Placering")]):e._e(),void 0===e.dialog_booking.handlers.find((function(t){return t.id===e.$store.state.profile.id}))?a("md-button",{staticClass:"md-primary",on:{click:e.booking_handle}},[e._v("Assistera")]):a("md-button",{on:{click:e.booking_handle}},[e._v("Sluta assistera")])],1):e._e(),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.dialog_booking=null}}},[e._v(" Stäng ")])],1)],1):e._e(),a("div",{staticClass:"md-layout md-gutter md-alignment-top"},[a("div",{staticClass:"md-layout-item md-xlarge-size-70 md-large-size-70 md-medium-size-70 md-small-size-70 md-xsmall-size-100"},[a("h1",[e.queue.open?e._e():a("md-icon",{staticClass:"md-size-2x md-accent"},[e._v(" lock ")]),e.queue.open?a("md-icon",{staticClass:"md-size-2x"},[e._v(" people ")]):e._e(),e._v(" "+e._s(e.queue.name)+" ")],1),a("p",{staticStyle:{"white-space":"pre-line"}},[e._v(" "+e._s(e.queue.description)+" ")]),e.queue.bookings.length>0?a("md-table",[a("md-table-row",[a("md-table-head",{staticStyle:{width:"30%"}},[e._v(" Tidslucka ")]),null!==e.$store.state.profile?a("md-table-head",{staticStyle:{width:"30%"}},[e._v(" Namn ")]):e._e(),null!==e.$store.state.profile?a("md-table-head",{staticStyle:{width:"40%"}},[e._v(" Kommentar ")]):a("md-table-head",{staticStyle:{width:"70%"}},[e._v(" Kommentar ")])],1),e._l(e.queue.bookings,(function(t){return a("md-table-row",{key:t.id,class:[{studentIsHandled:t.handlers.length>0},{myQueueRow:null!==e.$store.state.profile&&-1!==t.students.findIndex((function(t){return t.id===e.$store.state.profile.id}))}],staticStyle:{cursor:"pointer"},on:{click:function(a){e.dialog_booking=t}}},[a("md-table-cell",[e._v(" "+e._s(e.unix_to_datetime(t.timestamp))),a("br"),null!==t.location?a("div",{class:[{badLocation:t.bad_location}]},[e._v(" "+e._s(t.location)+" ")]):a("div",{staticClass:"noLocation"},[e._v(" ingen plats angiven ")])]),null!==e.$store.state.profile?a("md-table-cell",e._l(t.students,(function(t){return a("div",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),0):e._e(),a("md-table-cell",[null!==t.comment?a("span",[e._v(e._s(t.comment))]):e._e()])],1)}))],2):e._e(),e.queue.queuing.length>0?a("md-table",[a("md-table-row",[a("md-table-head",{staticStyle:{width:"30%"}},[e._v(" Namn ")]),a("md-table-head",{staticStyle:{width:"20%"}},[e._v(" Tid ")]),a("md-table-head",{staticStyle:{width:"50%"}},[e._v(" Kommentar ")])],1),!0===e.view_entire_queue?e._l(e.queue.queuing,(function(t,s){return a("md-table-row",{key:t.profile.id,class:[{studentIsHandled:t.handlers.length>0},{myQueueRow:null!==e.$store.state.profile&&t.profile.id===e.$store.state.profile.id}],staticStyle:{cursor:"pointer"},on:{click:function(a){e.dialog_queuing=t}}},[a("md-table-cell",[null!==t.action?a("md-badge",{staticClass:"md-primary md-square",attrs:{"md-content":t.action.name}}):e._e(),null!==t.profile.name?a("div",{staticStyle:{"white-space":"nowrap"}},[e._v(" "+e._s(s+1)+". "+e._s(t.profile.name)+" ")]):e._e(),a("span",{class:[{badLocation:t.bad_location}]},[e._v(e._s(e.nice_location(t.location))+" ")])],1),a("md-table-cell",[e._v(e._s(e.unix_to_datetime(t.entered_at))+" ")]),a("md-table-cell",[null!==t.comment?a("span",[e._v(e._s(t.comment))]):e._e()])],1)})):e._e()],2):e._e()],1),a("div",{staticClass:"md-layout-item md-xlarge-size-30 md-large-size-30 md-medium-size-30 md-small-size-30 md-xsmall-size-100"},[e.is_assistant_in_queue?a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Alternativ ")])]),a("md-card-content",[a("md-list",[a("md-list-item",{on:{click:function(t){e.prompt_broadcast=!0}}},[a("md-icon",[e._v("chat_bubble_outline")]),a("span",{staticClass:"md-list-item-text"},[e._v("Meddela samtliga")])],1),a("md-list-item",{on:{click:function(t){e.promt_notify_faculty=!0}}},[a("md-icon",[e._v("chat_bubble")]),a("span",{staticClass:"md-list-item-text"},[e._v("Meddela assistenter")])],1),a("md-list-item",{attrs:{disabled:0===e.queue.queuing.length},on:{click:function(t){0!==e.queue.queuing.length&&(e.promt_clear_queue=!0)}}},[a("md-icon",[e._v("clear_all")]),a("span",{staticClass:"md-list-item-text"},[e._v("Rensa kön")])],1),a("md-list-item",{on:{click:function(t){return e.toggle_open()}}},[e.queue.open?a("md-icon",[e._v(" lock ")]):a("md-icon",[e._v(" lock_open ")]),e.queue.open?a("span",{staticClass:"md-list-item-text"},[e._v("Stäng kön")]):a("span",{staticClass:"md-list-item-text"},[e._v("Öppna kön")])],1),a("md-list-item",{attrs:{to:"/queues/"+this.queue.name+"/edit"}},[a("md-icon",[e._v("settings")]),a("span",{staticClass:"md-list-item-text"},[e._v("Inställningar")])],1),a("md-list-item",{attrs:{to:"/queues/"+this.queue.name+"/history"}},[a("md-icon",[e._v("history")]),a("span",{staticClass:"md-list-item-text"},[e._v("Historik")])],1)],1)],1)],1):e._e(),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e.in_queue?a("span",[e._v("Hantera min köplats")]):a("span",[e._v("Gå med i kön")])])]),a("md-card-content",[e.in_queue||e.queue.open?e.in_queue||!(e.queue.rooms.length>0)||null!==e.$store.state.location&&e.queue.rooms.map((function(e){return e.id})).includes(e.$store.state.location.room_id)?e.in_queue||null!==e.$store.state.location||e.$store.state.is_kthlan||!e.queue.force_kthlan?null===e.$store.state.profile?a("div",[a("p",[e._v("För att kunna ställa dig i kön måste du logga in.")]),a("md-button",{staticClass:"md-primary md-raised",on:{click:function(t){return e.$root.redirect_login()}}},[e._v(" Logga in ")])],1):!e.in_queue&&e.blocked_by_whitelist?a("div",[a("p",[e._v("Den här kön kan du inte ställa dig i.")])]):a("div",[null===e.$store.state.location?a("md-field",[a("label",{attrs:{for:"location"}},[e._v("Plats")]),a("md-input",{attrs:{id:"location",type:"text",required:""},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1):e._e(),a("md-field",[a("label",{attrs:{for:"comment"}},[e._v("Kommentar")]),a("md-input",{attrs:{required:e.queue.force_comment,type:"text",id:"comment"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1),e._l(e.queue.actions,(function(t){return a("div",{key:t.id},[a("md-radio",{class:"md-"+t.color,attrs:{value:t.id},model:{value:e.action,callback:function(t){e.action=t},expression:"action"}},[e._v(" "+e._s(t.name)+" ")])],1)})),e.in_queue?a("md-card-actions",[a("md-button",{staticClass:"md-accent",attrs:{type:"submit"},on:{click:function(t){return e.dequeue(e.$store.state)}}},[a("md-icon",[e._v("person_add_disabled")]),e._v(" Lämna kön ")],1),a("md-button",{staticClass:"md-primary",attrs:{disabled:e.queue.force_comment&&(null===e.comment||0===e.comment.length)||e.queue.force_action&&null===e.action,type:"submit"},on:{click:e.update_own_details}},[a("md-icon",[e._v("update")]),e._v(" Uppdatera ")],1)],1):a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{disabled:!e.queue.open||e.queue.force_comment&&(null===e.comment||0===e.comment.length)||e.queue.force_action&&null===e.action,type:"submit"},on:{click:e.enqueue}},[a("md-icon",[e._v("person_add")]),e._v(" Gå med i kön ")],1)],1)],2):a("div",[a("p",[e._v("För att kunna ställa dig i kön måste du vara ansluten till KTHLAN, exempelvis via eduroam.")])]):a("div",[a("p",[e._v("För att kunna ställa dig i kön måste du vara inloggad på en dator i någon av följande rum.")]),a("ul",e._l(e.queue.rooms,(function(t){return a("li",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),0)]):a("div",[null===e.$store.state.profile?a("div",[a("p",[e._v("Kön är stängd och du är inte inloggad.")]),a("md-button",{staticClass:"md-primary md-raised",on:{click:function(t){return e.$root.redirect_login()}}},[e._v(" Logga in ")])],1):a("p",[e._v(" Kön är stängd. ")])])])],1)],1)])],1):e._e()},S=[],$={name:"Queue",data:()=>({queue:null,location:null,comment:null,action:null,notify_active:!1,broadcast_active:!1,broadcast_message:null,notification_message:null,active_broadcast:!1,prompt_broadcast:!1,prompt_notify:!1,promt_notify_faculty:!1,promt_clear_queue:!1,message:null,booking_location:null,dialog_queuing:null,dialog_booking:null}),methods:{enqueue(){fetch("/api/queues/"+this.queue.name+"/queuing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:this.location,action:this.action,comment:this.comment})}).then(e=>{201!==e.status&&e.json().then(e=>{alert(e.message)})})},update_own_details(){fetch("/api/queues/"+this.queue.name+"/queuing/"+this.$store.state.profile.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:this.location,action:this.action,comment:this.comment})}).then(e=>{200!==e.status&&e.json().then(e=>{alert(e.message)})})},dequeue(e){fetch("/api/queues/"+this.queue.name+"/queuing/"+e.profile.id,{method:"DELETE"}).then(t=>{200===t.status?e.profile.id===this.$store.state.profile.id&&(this.comment=null,this.action=null):t.json().then(e=>{alert(e.message)})})},queuing_handle(e){const t=this.queue.queuing.find(t=>t.profile.id===e.id),a=void 0===t.handlers.find(e=>e.id===this.$store.state.profile.id);fetch("/api/queues/"+this.queue.name+"/queuing/"+t.profile.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_handling:a})})},move_student_first(e){fetch("/api/queues/"+this.queue.name+"/queuing/"+e.profile.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({move_after:null})})},move_student_to_position(e){const t=parseInt(document.getElementById("pos").value);if(t>this.queue.queuing.length||t<1||isNaN(t))alert("Positionen du valt är inte giltig.");else if(1===t)this.move_student_first(e);else{const a=this.queue.queuing[t-2];fetch("/api/queues/"+this.queue.name+"/students/"+e.profile.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({move_after:a.profile.id})})}},notify(e){this.$store.state.socket.emit("notify",{queue:this.queue.id,message:this.message,recipient:e.profile.id}),this.message=null},broadcast(){this.$store.state.socket.emit("broadcast",{queue:this.queue.id,message:this.message}),this.message=null},broadcast_faculty(){this.$store.state.socket.emit("notify_faculty",{queue:this.queue.id,message:this.message}),this.message=null},queuing_bad_location(e){fetch("/api/queues/"+this.queue.name+"/queuing/"+e.profile.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({bad_location:!e.bad_location})})},unix_to_datetime(e){const t=new Date(e),a=new Date,s="0"+t.getHours(),n="0"+t.getMinutes(),i=s.slice(-2)+":"+n.slice(-2);if(a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear())return i;var o=t.getDate()+" "+["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"][t.getMonth()];return a.getFullYear()!==t.getFullYear()&&(o+=" "+t.getFullYear()),o+", "+i},nice_location(e){return"string"===typeof e?e:e.name},purge(){fetch("/api/queues/"+this.queue.id+"/queuing",{method:"DELETE"})},toggle_open(){fetch("/api/queues/"+this.queue.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({open:!this.queue.open})})},fetch_queue(){fetch("/api/queues/"+this.$route.params.name).then(e=>e.json()).then(e=>{this.queue=e,null!==this.$store.state.location&&(this.location=this.$store.state.location.name),this.sort_bookings()})},sort_bookings(){this.queue.bookings.sort((e,t)=>e.timestamp<t.timestamp?-1:e.timestamp>t.timestamp?1:e.id<t.id?-1:e.id>t.id?1:0)},booking_set_location(){fetch("/api/queues/"+this.queue.id+"/bookings/"+this.dialog_booking.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:this.booking_location})}).then(e=>{e.ok&&(this.dialog_booking=null)})},booking_bad_location(){fetch("/api/queues/"+this.queue.name+"/bookings/"+this.dialog_booking.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({bad_location:!this.dialog_booking.bad_location})})},booking_handle(){fetch("/api/queues/"+this.queue.name+"/bookings/"+this.dialog_booking.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_handling:-1===this.dialog_booking.handlers.findIndex(e=>e.id===this.$store.state.profile.id)})})},booking_remove(){fetch("/api/queues/"+this.queue.id+"/bookings/"+this.dialog_booking.id,{method:"DELETE"})},socket_handle_update_queue(e){if(e.queue===this.queue.id){for(var t of Object.keys(e.changes))this.queue[t]=e.changes[t];if(null!==this.dialog_queuing){const e=this.queue.queuing.findIndex(e=>e.profile.id===this.dialog_queuing.profile.id);this.dialog_queuing=-1===e?null:this.queue.queuing[e]}}},socket_handle_update_queue_queuing_student(e){if(e.queue===this.queue.id)for(const t of this.queue.queuing)if(t.profile.id===e.student.profile.id){for(const a of Object.keys(e.student))t[a]=e.student[a];break}},socket_handle_update_booking(e){e.queue===this.queue.id&&(this.queue.bookings=this.queue.bookings.filter(t=>t.id!==e.booking.id),this.queue.bookings.push(e.booking),this.sort_bookings(),null!==this.dialog_booking&&this.dialog_booking.id===e.booking.id&&(this.dialog_booking=e.booking,this.booking_location=e.booking.location))},socket_handle_delete_booking(e){this.queue.bookings=this.queue.bookings.filter(t=>t.id!==e),null!==this.dialog_booking&&this.dialog_booking.id===e&&(this.dialog_booking=null)},socket_handle_broadcast(e){e.queue===this.queue.id&&(this.broadcast_active=!0,this.broadcast_message=e.message+"\n\nHälsningar från "+e.sender.name+" <"+e.sender.user_name+"@kth.se>")},socket_handle_notify(e){e.queue===this.queue.id&&(this.notify_active=!0,this.notification_message="Personligt meddelande:\n"+e.message+"\n\nHälsningar från "+e.sender.name+" <"+e.sender.user_name+"@kth.se>")}},beforeDestroy(){this.$store.state.socket.removeListener("connect",this.fetch_queue),this.$store.state.socket.removeListener("update_queue",this.socket_handle_update_queue),this.$store.state.socket.removeListener("update_queue_queuing_student",this.socket_handle_update_queue_queuing_student),this.$store.state.socket.removeListener("update_booking",this.socket_handle_update_booking),this.$store.state.socket.removeListener("delete_booking",this.socket_handle_delete_booking),this.$store.state.socket.removeListener("broadcast",this.socket_handle_broadcast),this.$store.state.socket.removeListener("notify",this.socket_handle_notify)},created(){this.$store.state.socket.on("connect",this.fetch_queue),this.$store.state.socket.on("update_queue",this.socket_handle_update_queue),this.$store.state.socket.on("update_queue_queuing_student",this.socket_handle_update_queue_queuing_student),this.$store.state.socket.on("update_booking",this.socket_handle_update_booking),this.$store.state.socket.on("delete_booking",this.socket_handle_delete_booking),this.$store.state.socket.on("broadcast",this.socket_handle_broadcast),this.$store.state.socket.on("notify",this.socket_handle_notify),this.fetch_queue()},computed:{in_queue(){if(null===this.$store.state.profile)return!1;for(const e of this.queue.queuing)if(this.$store.state.profile.id===e.profile.id)return!0;return!1},is_assistant_in_queue(){return null!==this.$store.state.profile&&(!0===this.$store.state.profile.teacher||-1!==this.queue.assistants.findIndex(e=>e.id===this.$store.state.profile.id))},blocked_by_whitelist(){if(0===this.queue.students.length)return!1;if(!0===this.is_assistant_in_queue)return!1;for(const e of this.queue.students)if(null!==e&&e.id===this.$store.state.profile.id)return!1;return!0},profile_in_white_list(){for(const e of this.queue.students)if(null!==e&&this.$store.state.profile.id===e.id)return!0;return!1},has_white_list_and_profile_in_it(){return this.has_white_list&&this.profile_in_white_list},view_entire_queue(){return!this.has_white_list||this.is_assistant_in_queue},profile_queuing:function(){return this.queue.queuing.filter((function(e){return e.id===this.$store.state.profile.id}))}},watch:{dialog_queuing:function(){this.dialog_booking=null},dialog_booking:function(e){this.dialog_queuing=null,null!==e&&(this.booking_location=e.location)}}},T=$,E=Object(u["a"])(T,C,S,!1,null,null,null),O=E.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return null!==e.queue&&null!==e.colors&&null!==e.existing_rooms&&e.is_assistant_in_queue?a("div",[a("md-dialog-confirm",{attrs:{"md-active":e.promt_delete_queue,"md-title":"Vill du radera kön?","md-confirm-text":"Ja, radera kön","md-cancel-text":"Nej, återgå"},on:{"update:mdActive":function(t){e.promt_delete_queue=t},"update:md-active":function(t){e.promt_delete_queue=t},"md-confirm":e.delete_queue,"md-cancel":function(t){e.promt_delete_queue=!1}}}),a("h1",[e._v("Inställningar för "+e._s(this.queue.name))]),a("md-card",[a("md-card-content",[a("form",{attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.update_settings(t)}}},[a("md-field",[a("label",[e._v("Namn")]),a("md-input",{attrs:{type:"text",id:"name_new",name:"name_new"},model:{value:e.name_new,callback:function(t){e.name_new=t},expression:"name_new"}})],1),a("md-field",[a("label",[e._v("Beskrivning")]),a("md-textarea",{attrs:{id:"new_description",name:"new_description"},model:{value:e.queue.description,callback:function(t){e.$set(e.queue,"description",t)},expression:"queue.description"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Spara ändringar ")])],1)],1)])],1),a("br"),a("md-card",[a("md-card-content",[a("md-switch",{on:{change:function(t){return e.update_force()}},model:{value:e.queue.force_action,callback:function(t){e.$set(e.queue,"force_action",t)},expression:"queue.force_action"}},[e._v(" Kräv action ")]),a("md-switch",{on:{change:function(t){return e.update_force()}},model:{value:e.queue.force_comment,callback:function(t){e.$set(e.queue,"force_comment",t)},expression:"queue.force_comment"}},[e._v(" Kräv kommentar ")])],1)],1),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Schemalagda händelser ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_task(t)}}},[a("md-field",[a("label",{attrs:{for:"task_type"}},[e._v("Händelse")]),a("md-select",{attrs:{id:"task_type",required:""},model:{value:e.task_type,callback:function(t){e.task_type=t},expression:"task_type"}},[a("md-option",{attrs:{value:"OPEN"}},[e._v(" Öppna kön ")]),a("md-option",{attrs:{value:"CLOSE"}},[e._v(" Stäng kön ")])],1)],1),a("md-field",[a("label",[e._v("Datum och tid")]),a("md-input",{attrs:{type:"datetime-local",required:""},model:{value:e.task_deadline,callback:function(t){e.task_deadline=t},expression:"task_deadline"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit",disabled:null===e.task_type||null===e.task_deadline||0===e.task_deadline.length}},[e._v(" Schemalägg ny händelse ")])],1)],1),e.tasks.length>0?a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Händelse")]),a("md-table-head",[e._v("Tidpunkt")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.tasks,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",["OPEN"===t.type?a("span",[e._v("Öppna kön")]):e._e(),"CLOSE"===t.type?a("span",[e._v("Stäng kön")]):e._e()]),a("md-table-cell",[e._v(e._s(e.unix_to_datetime(t.deadline)))]),a("md-table-cell",[a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_task(t)}}},[e._v(" Radera ")])],1)],1)}))],2):e._e()],1)],1),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Tillåtna salar ")])]),a("md-card-content",[a("p",[e._v("Om inga anges kan studenterna sitta var som helst.")]),a("md-switch",{on:{change:function(t){return e.update_force()}},model:{value:e.queue.force_kthlan,callback:function(t){e.$set(e.queue,"force_kthlan",t)},expression:"queue.force_kthlan"}},[e._v(" Kräv KTHLAN ")]),a("form",{attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.change_rooms(t)}}},e._l(e.existing_rooms,(function(t){return a("md-checkbox",{key:t.id,attrs:{value:t.id},on:{change:function(a){return e.change_room(t.id)}},model:{value:e.clicked_rooms,callback:function(t){e.clicked_rooms=t},expression:"clicked_rooms"}},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("br"),e.$store.state.profile.teacher?a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Assistenter ")])]),a("md-card-content",[a("div",{staticClass:"md-layout"},[a("form",{staticClass:"md-layout-item",staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_assistant(t)}}},[a("md-field",[a("label",{attrs:{for:"user_name_assistant"}},[e._v("KTH-användarnamn")]),a("md-input",{attrs:{type:"text",id:"user_name_assistant"},model:{value:e.user_name_assistant,callback:function(t){e.user_name_assistant=t},expression:"user_name_assistant"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit",disabled:null===e.user_name_assistant||0===e.user_name_assistant.length}},[e._v(" Lägg till assistent ")])],1)],1),a("div",{staticClass:"md-layout-item"}),a("form",{staticClass:"md-layout-item",staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_assistants_from_course(t)}}},[a("md-field",[a("label",{attrs:{for:"course_code_assistant"}},[e._v("Kurskod")]),a("md-input",{attrs:{type:"text",id:"course_code_assistant"},model:{value:e.course_code_assistant,callback:function(t){e.course_code_assistant=t},expression:"course_code_assistant"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit",disabled:null===e.course_code_assistant||0===e.course_code_assistant.length}},[e._v(" Lägg till assistenter från kurs ")])],1)],1)]),e.queue.assistants.length>0?a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Användarnamn")]),a("md-table-head",[e._v("Namn")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.sorted_assistants,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(t.user_name))]),a("md-table-cell",[e._v(e._s(t.name))]),a("md-table-cell",[a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_assistant(t)}}},[e._v(" Radera ")])],1)],1)}))],2):e._e()],1)],1):e._e(),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Vitlista ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_student(t)}}},[a("md-field",[a("label",{attrs:{for:"user_name_student"}},[e._v("KTH-användarnamn")]),a("md-input",{attrs:{type:"text",id:"user_name_student"},model:{value:e.user_name_student,callback:function(t){e.user_name_student=t},expression:"user_name_student"}})],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit",disabled:null===e.user_name_student||0===e.user_name_student.length}},[e._v(" Lägg till student ")])],1)],1),e.queue.students.length>0?a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Användarnamn")]),a("md-table-head",[e._v("Namn")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.sorted_students,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(t.user_name))]),a("md-table-cell",[e._v(e._s(t.name))]),a("md-table-cell",[a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_student(t)}}},[e._v(" Radera ")])],1)],1)}))],2):a("p",[e._v(" Vitlistan är tom; alla studenter kan ställa sig i kön. ")])],1)],1),a("br"),a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Actions ")])]),a("md-card-content",[a("form",{staticStyle:{display:"inline-flex"},attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.add_action(t)}}},[a("md-field",[a("label",{attrs:{for:"action_name"}},[e._v("Namn på action")]),a("md-input",{attrs:{type:"text",id:"action_name",required:""},model:{value:e.action_name,callback:function(t){e.action_name=t},expression:"action_name"}})],1),a("md-field",[a("label",{attrs:{for:"action_color"}},[e._v("Färg på action")]),a("md-select",{attrs:{name:"Color",id:"action_color",required:""},model:{value:e.action_color,callback:function(t){e.action_color=t},expression:"action_color"}},e._l(e.colors,(function(t){return a("md-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("md-card-actions",[a("md-button",{staticClass:"md-primary",attrs:{type:"submit",disabled:null===e.action_name||0===e.action_name.length||null===e.action_color}},[e._v(" Lägg till action ")])],1)],1),e.queue.actions.length>0?a("md-table",[a("md-table-row",[a("md-table-head",[e._v("Action")]),a("md-table-head",[e._v("Färg")]),a("md-table-head",[e._v("Alternativ")])],1),e._l(e.queue.actions,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(t.name))]),a("md-table-cell",[e._v(e._s(t.color))]),a("md-table-cell",[a("md-button",{staticClass:"md-accent",on:{click:function(a){return e.remove_action(t)}}},[e._v(" Radera ")])],1)],1)}))],2):e._e()],1)],1),a("br"),e.$store.state.profile.teacher?a("md-card",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Ta bort kön ")])]),a("md-card-content",[a("p",[e._v("Om du tar bort kön försvinner den och all associerad statistik permanent.")]),a("md-button",{staticClass:"md-raised md-accent",on:{click:function(t){return e.delete_queue()}}},[e._v(" Ta bort kön ")])],1)],1):e._e()],1):e._e()},A=[],L={name:"QueueEdit",data:()=>({queue:null,name_new:null,tasks:[],colors:null,user_name_assistant:null,course_code_assistant:null,user_name_student:null,action_name:null,action_color:null,clicked_rooms:[],existing_rooms:null,task_type:null,task_deadline:null,promt_delete_queue:!1}),methods:{update_settings(){fetch("/api/queues/"+this.queue.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name_new,description:this.queue.description})}).then(e=>{e.ok?fetch("/api/queues/"+this.queue.id).then(e=>e.json()).then(e=>this.$router.push("/queues/"+e.name)):400===e.status?e.json().then(e=>{alert(e.message)}):alert("Ett fel inträffade. Se webbläsarens konsol.")}).catch(()=>{alert("Misslyckades med att kontakta Enqueue. Är du ansluten till internet?")})},update_force(){fetch("/api/queues/"+this.queue.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({force_kthlan:this.queue.force_kthlan,force_action:this.queue.force_action,force_comment:this.queue.force_comment})}).then(e=>{200!==e.status&&e.json().then(e=>{alert(e)})})},change_room(e){this.queue.rooms.map(e=>e.id).includes(e)?fetch("/api/queues/"+this.queue.name+"/rooms/"+e,{method:"DELETE"}):fetch("/api/queues/"+this.queue.name+"/rooms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:e})})},update_clicked_rooms(){if(null===this.queue||null===this.existing_rooms)return;const e=this.queue.rooms.map(e=>e.id);this.clicked_rooms=[];for(const t of this.existing_rooms)e.includes(t.id)&&this.clicked_rooms.push(t.id)},change_actions(){fetch("/api/queues/"+this.queue.id+"/actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.action_name,color:this.action_color})}).then(e=>{201===e.status&&(this.action_name=null,this.action_color=null)})},delete_queue(){this.promt_delete_queue?fetch("/api/queues/"+this.queue.id,{method:"DELETE"}).then(e=>{200===e.status?this.$router.push("/queues"):alert("Ett fel inträffade när kön skulle raderas.")}):this.promt_delete_queue=!0},add_assistant(){fetch("/api/queues/"+this.queue.id+"/assistants",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{user_name:this.user_name_assistant}])}).then(e=>{e.ok?(this.user_name_assistant=null,e.json().then(e=>{0===e.count_added&&alert("Personen är redan assistent i den här kön.")})):400===e.status?e.json().then(e=>{switch(e.data){case"INVALID_LIST_ELEMENT":alert("Ogiltigt eller okänt användarnamn.");break;default:alert(e.message)}}):alert("Ett fel inträffade. Se webbläsarens konsol.")})},add_assistants_from_course(){fetch("/api/queues/"+this.queue.id+"/assistants",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:this.course_code_assistant})}).then(e=>{e.ok?(this.course_code_assistant=null,e.json().then(e=>{0===e.count_added&&alert("Inga nya assistenter lades till.")})):400===e.status?e.json().then(e=>{switch(e.data){case"INVALID_COURSE_CODE":alert("Ogiltig kurskod.");break;case"RETRIEVAL_FAILED":alert("Misslyckades med att hämta assistentlistan från KTH. Felaktig kurskod?");break;default:alert(e.message)}}):alert("Ett fel inträffade. Se webbläsarens konsol.")})},remove_assistant(e){fetch("/api/queues/"+this.queue.id+"/assistants/"+e.id,{method:"DELETE"})},add_student(){fetch("/api/queues/"+this.queue.id+"/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_name:this.user_name_student})}).then(e=>{201===e.status&&(this.user_name_student="")})},remove_student(e){fetch("/api/queues/"+this.queue.id+"/students/"+e.id,{method:"DELETE"})},add_action(){fetch("/api/queues/"+this.queue.id+"/actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.action_name,color:this.action_color})}).then(()=>{this.action_name=null,this.action_color=null})},remove_action(e){fetch("/api/queues/"+this.queue.id+"/actions/"+e.id,{method:"DELETE"})},add_task(){fetch("/api/queues/"+this.queue.id+"/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:this.task_type,data:{},deadline:new Date(this.task_deadline).valueOf()})}).then(e=>{201===e.status&&(this.task_type=null)})},remove_task(e){fetch("/api/queues/"+this.queue.id+"/tasks/"+e.id,{method:"DELETE"})},fetch_queue(){fetch("/api/queues/"+this.$route.params.name).then(e=>e.json()).then(e=>{this.queue=e,e.rooms.length>0&&this.update_clicked_rooms(),null===this.name_new&&(this.name_new=e.name),fetch("/api/queues/"+e.name+"/tasks").then(e=>e.json()).then(e=>{this.tasks=e})})},unix_to_datetime(e){const t=new Date(e),a=new Date,s="0"+t.getHours(),n="0"+t.getMinutes(),i=s.slice(-2)+":"+n.slice(-2);if(a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear())return i;var o=t.getDate()+" "+["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"][t.getMonth()];return a.getFullYear()!==t.getFullYear()&&(o+=" "+t.getFullYear()),o+", "+i},socket_handle_update_queue(e){for(var t of Object.keys(e.changes))this.queue[t]=e.changes[t],"rooms"===t&&this.update_clicked_rooms()},socket_handle_remove_task(e){this.tasks=this.tasks.filter(t=>t.id!==e.task)},socket_handle_add_task(e){e.queue===this.queue.id&&(this.tasks.push(e.task),this.tasks.sort((e,t)=>e.deadline===t.deadline?e.id===t.id?0:e.id>t.id?1:-1:e.deadline>t.deadline?1:-1))},sort_users:e=>e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)},beforeDestroy(){this.$store.state.socket.removeListener("connect",this.fetch_queue),this.$store.state.socket.removeListener("update_queue",this.socket_handle_update_queue),this.$store.state.socket.removeListener("remove_task",this.socket_handle_remove_task),this.$store.state.socket.removeListener("add_task",this.socket_handle_add_task)},async created(){this.$store.state.socket.on("connect",this.fetch_queue),this.$store.state.socket.on("update_queue",this.socket_handle_update_queue),this.$store.state.socket.on("remove_task",this.socket_handle_remove_task),this.$store.state.socket.on("add_task",this.socket_handle_add_task);const e=new Date;e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.setSeconds(0),e.setMilliseconds(0),this.task_deadline=e.toISOString().slice(0,-1),this.fetch_queue(),this.colors=(await l.a.get("/colors")).data,this.existing_rooms=(await l.a.get("/rooms")).data,this.update_clicked_rooms()},computed:{is_assistant_in_queue(){return null!==this.$store.state.profile&&(!0===this.$store.state.profile.teacher||-1!==this.queue.assistants.findIndex(e=>e.id===this.$store.state.profile.id))},sorted_assistants:function(){return this.sort_users(this.queue.assistants)},sorted_students:function(){return this.sort_users(this.queue.students)}}},N=L,P=Object(u["a"])(N,D,A,!1,null,null,null),I=P.exports,z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.queue&&null!==e.$store.state.profile?a("div",[a("h1",[e._v("Historik för "+e._s(e.queue.name))]),e.is_assistant_in_queue?a("p",[e._v(" Här kan du se historisk data för köns händelser och studenter. ")]):a("p",[e._v(" Här kan du se dina historiska besök i kön. ")]),a("form",{staticClass:"md-layout md-gutter",on:{submit:function(t){return t.preventDefault(),e.fetch_history(t)}}},[a("div",{staticClass:"md-layout-item"},[a("md-field",[a("label",[e._v("Startdatum:")]),a("md-input",{attrs:{type:"date",required:""},model:{value:e.date_start,callback:function(t){e.date_start=t},expression:"date_start"}})],1)],1),a("div",{staticClass:"md-layout-item"},[a("md-field",[a("label",[e._v("Slutdatum:")]),a("md-input",{attrs:{type:"date",required:""},model:{value:e.date_end,callback:function(t){e.date_end=t},expression:"date_end"}})],1)],1),a("div",{staticClass:"md-layout-item"},[a("md-button",{staticClass:"md-primary",attrs:{type:"submit"}},[e._v(" Hämta historik ")])],1)]),null!==e.events?a("md-card",{staticStyle:{"margin-bottom":"50px"}},[a("md-card-content",[a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Händelser ")])]),e.events.length>0?a("md-table",[a("md-table-row",[a("md-table-head",{staticStyle:{width:"200px"}},[e._v(" Tidpunkt ")]),a("md-table-head",[e._v("Händelse")])],1),e._l(e.events,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[e._v(e._s(e.unix_to_datetime(t.timestamp)))]),a("md-table-cell",[e._v(" "+e._s(t.nice_description)+" "),"DESCRIPTION"===t.type&&null!==t.data.old?a("div",{staticClass:"history_old"},[e._v(" "+e._s(t.data.old)+" ")]):e._e(),"DESCRIPTION"===t.type&&null!==t.data.new?a("div",{staticClass:"history_new"},[e._v(" "+e._s(t.data.new)+" ")]):e._e()])],1)}))],2):a("p",[e._v(" Det finns inga händelser att visa för den valda datumperioden. ")])],1)],1):e._e(),null!==e.queuings?a("md-card",[a("md-card-content",[e.is_assistant_in_queue?a("md-card-header",[a("h2",{staticClass:"md-title"},[e._v(" Studenter i kön ")])]):e._e(),e.queuings.length>0?a("md-table",[a("md-table-row",[a("md-table-head",{staticStyle:{width:"200px"}},[e._v(" Tidpunkt ")]),e.is_assistant_in_queue?a("md-table-head",[e._v(" Student ")]):e._e(),a("md-table-head",[e._v("Plats")]),a("md-table-head",[e._v("Meddelande")]),a("md-table-head",[e._v("Assistent")])],1),e._l(e.queuings,(function(t){return a("md-table-row",{key:t.id},[a("md-table-cell",[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e.unix_to_datetime(t.timestamp_enter)))]),e._v(" → "),a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e.unix_to_datetime(t.timestamp_leave)||"..."))])]),e.is_assistant_in_queue?a("md-table-cell",[a("span",{staticStyle:{"white-space":"nowrap"},attrs:{title:t.profile.user_name+"@kth.se"}},[e._v(e._s(t.profile.name))])]):e._e(),a("md-table-cell",[e._v(" "+e._s(t.location)+" ")]),a("md-table-cell",[null!==t.action?a("div",[e._v(" "+e._s(t.action)+" ")]):e._e(),null!==t.comment?a("div",[e._v(" "+e._s(t.comment)+" ")]):e._e()]),a("md-table-cell",e._l(t.handlers,(function(t){return a("div",{key:t.user_name,staticStyle:{"white-space":"nowrap"},attrs:{title:t.user_name+"@kth.se"}},[e._v(" "+e._s(t.name)+" ")])})),0)],1)}))],2):a("p",[e._v(" Det finns ingen aktivitet i kön att visa för den valda datumperioden. ")])],1)],1):e._e()],1):e._e()},H=[],M={name:"QueueHistory",data:()=>({queue:null,date_start:(e=>new Date(e.setDate(e.getDate()-7)))(new Date).toISOString().slice(0,10),date_end:(new Date).toISOString().slice(0,10),events:null,queuings:null}),methods:{unix_to_datetime(e){if(null===e)return null;const t=new Date(e),a=new Date,s="0"+t.getHours(),n="0"+t.getMinutes(),i=s.slice(-2)+":"+n.slice(-2);if(a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear())return i;let o=t.getDate()+" "+["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"][t.getMonth()];return a.getFullYear()!==t.getFullYear()&&(o+=" "+t.getFullYear()),o+", "+i},date_to_unix(e){return new Date(e).getTime()},async fetch_queue(){this.queue=(await l.a.get("/queues/"+this.$route.params.name)).data},async fetch_history(){this.events=null,this.queuings=null;const e=this.date_to_unix(this.date_start),t=this.date_to_unix(this.date_end)+86399e3;try{const a=(await l.a.get("/queues/"+this.queue.id+"/history?timestamp_start="+e+"&timestamp_end="+t)).data;if(!a.filtered){this.events=a.events.sort((e,t)=>t.timestamp-e.timestamp);for(const e of this.events)e.nice_description=this.generate_nice_description(e)}this.queuings=a.queuings.sort((e,t)=>t.timestamp_enter-e.timestamp_enter);for(const e of this.queuings){const t=[];for(const a of e.handlers)-1===t.findIndex(e=>e.user_id===a.user_id)&&t.push({user_id:a.user_id,name:a.profile.name,user_name:a.profile.user_name});e.handlers=t}}catch(a){switch(a.response?a.response.data:null){case"INVALID_START_DATE":alert("Startdatumet är ogiltigt.");break;case"INVALID_END_DATE":alert("Slutdatumet är ogiltigt.");break;case"END_DATE_BEFORE_START_DATE":alert("Slutdatumet får inte vara före startdatumet.");break;default:alert("Ett okänt fel inträffade.")}}},generate_nice_description(e){switch(e.type){case"OPEN":return null===e.profile?"Kön öppnades.":e.profile.name+" öppnade kön.";case"CLOSE":return null===e.profile?"Kön stängdes.":e.profile.name+" stängde kön.";case"DESCRIPTION":return null===e.data.old&&null!==e.data.new?e.profile.name+" lade till en beskrivning:":null!==e.data.old&&null===e.data.new?e.profile.name+" tog bort beskrivningen:":e.profile.name+" ändrade beskrivningen:";default:return e.type}},socket_handle_update_queue(e){if(e.queue===this.queue.id)for(var t of Object.keys(e.changes))this.queue[t]=e.changes[t]}},beforeDestroy(){this.$store.state.socket.removeListener("connect",this.fetch_queue),this.$store.state.socket.removeListener("update_queue",this.socket_handle_update_queue)},created(){this.$store.state.socket.on("connect",this.fetch_queue),this.$store.state.socket.on("update_queue",this.socket_handle_update_queue),this.fetch_queue()},computed:{is_assistant_in_queue(){return null!==this.$store.state.profile&&(!0===this.$store.state.profile.teacher||-1!==this.queue.assistants.findIndex(e=>e.id===this.$store.state.profile.id))}}},F=M,K=Object(u["a"])(F,z,H,!1,null,null,null),J=K.exports;s["default"].use(_["a"]);const R=[{path:"/",redirect:"/queues"},{path:"/admin",component:v},{path:"/queues",component:x},{path:"/queues/:name",component:O},{path:"/queues/:name/edit",component:I},{path:"/queues/:name/history",component:J}],Y=new _["a"]({mode:"history",base:"/",routes:R});var V=Y,U=a("2f62"),Q=a("8e27"),B=a.n(Q);s["default"].use(U["a"]);var G=new U["a"].Store({state:{profile:null,location:null,assisting_in:null,is_kthlan:null,socket_connected:!1,socket:B()()},mutations:{setProfile(e,t){e.profile=t},setLocation(e,t){e.location=t},setAssistingIn(e,t){e.assisting_in=t},isKthlan(e,t){e.is_kthlan=t},setSocketConnected(e,t){e.socket_connected=t}}}),W=a("43f9"),X=a.n(W);a("51de"),a("e094");s["default"].use(X.a),s["default"].config.productionTip=!1;const Z=a("c1df");s["default"].use(a("2ead"),{moment:Z}),l.a.defaults.withCredentials=!0,l.a.defaults.baseURL="/api";const ee=async()=>{new s["default"]({router:V,store:G,methods:{redirect_login(){document.location="/login?returnTo="+encodeURIComponent(window.location.pathname)}},render:e=>e(m)}).$mount("#app")};ee()}});
//# sourceMappingURL=app.19b88435.js.map